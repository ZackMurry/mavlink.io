<!DOCTYPE HTML><html lang="zh"><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>Serialization · MAVLink Developer Guide</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="../../gitbook/style.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-richquotes/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-anchors/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-page-toc-button/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-language-picker/plugin.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-highlight/website.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-theme-api/theme-api.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-theme-dronecode/theme_styles.css"rel="stylesheet"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="../../gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="../../gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="routing.html"rel="next"/><link href="message_signing.html"rel="prev"/></head><body><div id="common_dronecode_menu"><div class="large_version common_menu_logo"><a href="https://mavlink.io/en/"><img alt="Dronecode logo (large)"src="../../assets/site/logo_mavlink_header.png"/></a></div><div class="small_version common_menu_logo"><a href="https://mavlink.io/en/"><img alt="Dronecode logo (small)"src="../../assets/site/logo_mavlink_header.png"/></a></div><div class="common_menu_options"><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/messages/common.html">Messages</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/messages/common.html">Messages</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/faq.html">FAQ</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/faq.html">FAQ</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/implementations.html">Implementations</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/implementations.html">Implementations</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/examples/">Examples</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/examples/">Examples</a></div><div class="common_dronecode_menu_item large_version"><a href="https://mavlink.io/en/about/support.html">Support</a></div><div class="common_dronecode_menu_item small_version"><a href="https://mavlink.io/en/about/support.html">Help</a></div></div></div><div class="book"><div class="book-summary"><div id="book-search-input"role="search"><input placeholder="輸入並搜尋"type="text"/></div><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="../"><a href="../">简介</a><ul class="articles"><li class="chapter"data-level="1.1.1"data-path="../about/overview.html"><a href="../about/overview.html">Overview</a></li><li class="chapter"data-level="1.1.2"data-path="../about/faq.html"><a href="../about/faq.html">FAQ</a></li><li class="chapter"data-level="1.1.3"data-path="../about/implementations.html"><a href="../about/implementations.html">Implementations</a></li></ul></li><li class="chapter"data-level="1.2"data-path="../getting_started/"><a href="../getting_started/">Getting Started</a><ul class="articles"><li class="chapter"data-level="1.2.1"data-path="../getting_started/installation.html"><a href="../getting_started/installation.html">Install MAVLink</a></li><li class="chapter"data-level="1.2.2"data-path="../getting_started/generate_libraries.html"><a href="../getting_started/generate_libraries.html">Generate MAVLink Libraries</a></li><li class="chapter"data-level="1.2.3"data-path="../getting_started/use_libraries.html"><a href="../getting_started/use_libraries.html">使用MAVLINK库</a><ul class="articles"><li class="chapter"data-level="1.2.3.1"data-path="../mavgen_c/"><a href="../mavgen_c/">C (mavgen)</a><ul class="articles"><li class="chapter"data-level="1.2.3.1.1"data-path="../mavgen_c/message_signing_c.html"><a href="../mavgen_c/message_signing_c.html">信息签名</a></li><li class="chapter"data-level="1.2.3.1.2"data-path="../mavgen_c/examples.html"><a href="../mavgen_c/examples.html">Examples</a><ul class="articles"><li class="chapter"data-level="1.2.3.1.2.1"data-path="../mavgen_c/example_c_uart.md"><span>UART Interface (C)</span></li><li class="chapter"data-level="1.2.3.1.2.2"data-path="../mavgen_c/example_c_udp.md"><span>UDP Example (C)</span></li></ul></li></ul></li><li class="chapter"data-level="1.2.3.2"data-path="../mavgen_python/"><a href="../mavgen_python/">Python (mavgen)</a></li></ul></li><li class="chapter"data-level="1.2.4"data-path="../getting_started/ros.html"><a href="../getting_started/ros.html">针对ROS生成源文件</a></li></ul></li><li class="chapter"data-level="1.3"data-path="./"><a href="./">Guide</a><ul class="articles"><li class="chapter"data-level="1.3.1"data-path="mavlink_version.html"><a href="mavlink_version.html">MAVLink Versions</a></li><li class="chapter"data-level="1.3.2"data-path="mavlink_2.html"><a href="mavlink_2.html">MAVLink 2</a></li><li class="chapter"data-level="1.3.3"data-path="message_signing.html"><a href="message_signing.html">Message Signing</a></li><li class="chapter active"data-level="1.3.4"data-path="serialization.html"><a href="serialization.html">Serialization</a></li><li class="chapter"data-level="1.3.5"data-path="routing.html"><a href="routing.html">Routing</a></li><li class="chapter"data-level="1.3.6"data-path="general_telemetry.html"><a href="general_telemetry.html">General Telemetry</a></li><li class="chapter"data-level="1.3.7"data-path="offboard_control.html"><a href="offboard_control.html">Offboard Control</a></li><li class="chapter"data-level="1.3.8"data-path="../file_formats/"><a href="../file_formats/">File Formats</a></li><li class="chapter"data-level="1.3.9"data-path="uavcan_interaction.html"><a href="uavcan_interaction.html">UAVCAN Interaction</a></li><li class="chapter"data-level="1.3.10"data-path="scripts.html"><a href="scripts.html">Scripts</a></li><li class="chapter"data-level="1.3.11"data-path="xml_schema.html"><a href="xml_schema.html">MAVLink XML Schema</a></li><li class="chapter"data-level="1.3.12"data-path="define_xml_element.html"><a href="define_xml_element.html">Defining XML Enums/Messages</a></li><li class="chapter"data-level="1.3.13"data-path="../messages/"><a href="../messages/">Dialects</a><ul class="articles"><li class="chapter"data-level="1.3.13.1"data-path="../messages/ardupilotmega.html"><a href="../messages/ardupilotmega.html">ardupilotmega.xml</a></li><li class="chapter"data-level="1.3.13.2"data-path="../messages/ASLUAV.html"><a href="../messages/ASLUAV.html">ASLUAV.xml</a></li><li class="chapter"data-level="1.3.13.3"data-path="../messages/autoquad.html"><a href="../messages/autoquad.html">autoquad.xml</a></li><li class="chapter"data-level="1.3.13.4"data-path="../messages/icarous.html"><a href="../messages/icarous.html">icarous.xml</a></li><li class="chapter"data-level="1.3.13.5"data-path="../messages/matrixpilot.html"><a href="../messages/matrixpilot.html">matrixpilot.xml</a></li><li class="chapter"data-level="1.3.13.6"data-path="../messages/minimal.html"><a href="../messages/minimal.html">minimal.xml</a></li><li class="chapter"data-level="1.3.13.7"data-path="../messages/paparazzi.html"><a href="../messages/paparazzi.html">paparazzi.xml</a></li><li class="chapter"data-level="1.3.13.8"data-path="../messages/python_array_test.html"><a href="../messages/python_array_test.html">python_array_test.xml</a></li><li class="chapter"data-level="1.3.13.9"data-path="../messages/slugs.html"><a href="../messages/slugs.html">slugs.xml</a></li><li class="chapter"data-level="1.3.13.10"data-path="../messages/standard.html"><a href="../messages/standard.html">standard.xml</a></li><li class="chapter"data-level="1.3.13.11"data-path="../messages/test.html"><a href="../messages/test.html">test.xml</a></li><li class="chapter"data-level="1.3.13.12"data-path="../messages/ualberta.html"><a href="../messages/ualberta.html">ualberta.xml</a></li><li class="chapter"data-level="1.3.13.13"data-path="../messages/uAvionix.html"><a href="../messages/uAvionix.html">uAvionix.xml</a></li></ul></li></ul></li><li class="chapter"data-level="1.4"data-path="../messages/common.html"><a href="../messages/common.html">Messages (common)</a></li><li class="chapter"data-level="1.5"data-path="../services/"><a href="../services/">Microservices</a><ul class="articles"><li class="chapter"data-level="1.5.1"data-path="../services/heartbeat.html"><a href="../services/heartbeat.html">Heartbeat/Connection Protocol</a></li><li class="chapter"data-level="1.5.2"data-path="../services/mission.html"><a href="../services/mission.html">Mission Protocol</a></li><li class="chapter"data-level="1.5.3"data-path="../services/parameter.html"><a href="../services/parameter.html">Parameter Protocol</a></li><li class="chapter"data-level="1.5.4"data-path="../services/command.html"><a href="../services/command.html">Command Protocol</a></li><li class="chapter"data-level="1.5.5"data-path="../services/camera.html"><a href="../services/camera.html">Camera Protocol</a><ul class="articles"><li class="chapter"data-level="1.5.5.1"data-path="../services/camera_def.html"><a href="../services/camera_def.html">Camera Definition</a></li></ul></li><li class="chapter"data-level="1.5.6"data-path="../services/gimbal_v2.html"><a href="../services/gimbal_v2.html">Gimbal Protocol v2</a><ul class="articles"><li class="chapter"data-level="1.5.6.1"data-path="../services/gimbal.html"><a href="../services/gimbal.html">Gimbal Protocol v1 (superseded)</a></li></ul></li><li class="chapter"data-level="1.5.7"data-path="../services/component_def.html"><a href="../services/component_def.html">Component Definition</a></li><li class="chapter"data-level="1.5.8"data-path="../services/arm_authorization.html"><a href="../services/arm_authorization.html">Arm Authorization Protocol</a></li><li class="chapter"data-level="1.5.9"data-path="../services/image_transmission.html"><a href="../services/image_transmission.html">Image Transmission Protocol</a></li><li class="chapter"data-level="1.5.10"data-path="../services/ftp.html"><a href="../services/ftp.html">File Transfer Protocol (FTP)</a></li><li class="chapter"data-level="1.5.11"data-path="../services/landing_target.html"><a href="../services/landing_target.html">Landing Target Protocol</a></li><li class="chapter"data-level="1.5.12"data-path="../services/ping.html"><a href="../services/ping.html">Ping Protocol</a></li><li class="chapter"data-level="1.5.13"data-path="../services/trajectory.html"><a href="../services/trajectory.html">Path Planning (Trajectory) Protocol</a></li><li class="chapter"data-level="1.5.14"data-path="../services/smart_battery.html"><a href="../services/smart_battery.html">Smart Battery Protocol (WIP)</a></li><li class="chapter"data-level="1.5.15"data-path="../services/tunnel.html"><a href="../services/tunnel.html">Tunnel Protocol</a></li><li class="chapter"data-level="1.5.16"data-path="../services/opendroneid.html"><a href="../services/opendroneid.html">Open Drone ID Protocol</a></li></ul></li><li class="chapter"data-level="1.6"data-path="../contributing/contributing.html"><a href="../contributing/contributing.html">Contributing</a></li><li class="chapter"data-level="1.7"data-path="../about/support.html"><a href="../about/support.html">Support</a></li><li class="divider"></li><li><a href="https://www.gitbook.com"class="gitbook-link"target="blank">本書使用 GitBook 釋出</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><i class="fa fa-circle-o-notch fa-spin"></i> <a href="..">Serialization</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><h1 id="&#x5305;&#x7684;&#x5E8F;&#x5217;&#x5316;"><a href="#&#x5305;&#x7684;&#x5E8F;&#x5217;&#x5316;"class="plugin-anchor"name="&#x5305;&#x7684;&#x5E8F;&#x5217;&#x5316;"><i class="fa fa-link"aria-hidden="true"></i></a>&#x5305;&#x7684;&#x5E8F;&#x5217;&#x5316;</h1><p>&#x672C;&#x4E3B;&#x9898;&#x63D0;&#x4F9B;&#x6709;&#x5173; MAVLink &#x6570;&#x636E;&#x5305;&#x5E8F;&#x5217;&#x5316;&#x3001; (&#x5305;&#x62EC; MAVLink v1 &#x548C; v1 &#x6570;&#x636E;&#x5305;&#x7684;&#x7EBF;&#x683C;&#x5F0F;)&#x3001; &#x6D88;&#x606F;&#x6709;&#x6548;&#x8D1F;&#x8F7D;&#x4E2D;&#x5B57;&#x6BB5;&#x7684;&#x6392;&#x5E8F;&#x3001;&#x548C; CRC_EXTRA &#x7528;&#x4E8E;&#x786E;&#x4FDD;&#x53D1;&#x4EF6;&#x4EBA;&#x548C;&#x6536;&#x4EF6;&#x4EBA;&#x5171;&#x4EAB;&#x517C;&#x5BB9;&#x7684;&#x90AE;&#x4EF6;&#x5B9A;&#x4E49;&#x3002;</p><p>&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x6B63;&#x5728;&#x521B;&#x5EFA;/&#x7EF4;&#x62A4; MAVLink &#x751F;&#x6210;&#x5668;&#x7684;&#x5F00;&#x53D1;&#x8005;</p><blockquote class="alert clearfix alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong><p>MAVLink &#x7528;&#x6237;&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x7406;&#x89E3;&#x5E8F;&#x5217;&#x5316;&#x683C;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x7F16;&#x7801;/&#x89E3;&#x7801;&#x7531; MAVLink &#x5E93;&#x5904;&#x7406;&#x3002;</p></blockquote><h2 id="packet_format"><a href="#packet_format"class="plugin-anchor"name="packet_format"><i class="fa fa-link"aria-hidden="true"></i></a>&#x6570;&#x636E;&#x5305;&#x683C;&#x5F0F;</h2><p>&#x672C;&#x8282;&#x663E;&#x793A; MAVLink &#x6570;&#x636E;&#x5305;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x6D88;&#x606F;&#x683C;&#x5F0F;(&#x683C;&#x5F0F;&#x7531;<a href="https://en.wikipedia.org/wiki/CAN_bus"target="_blank">CAN</a> &#x548C; SAE AS-4 &#x6807;&#x51C6;&#x542F;&#x53D1;)&#x3002;</p><h3 id="mavlink2_packet_format"><a href="#mavlink2_packet_format"class="plugin-anchor"name="mavlink2_packet_format"><i class="fa fa-link"aria-hidden="true"></i></a>MAVLink 2 &#x7684;&#x6570;&#x636E;&#x5305;&#x683C;&#x5F0F;</h3><p>&#x4E0B;&#x9762;&#x662F; <a href="mavlink_2.html">MAVLink 2 </a>&#x6570;&#x636E;&#x5305;&#x7684;&#x7EBF;&#x5916;&#x683C;&#x5F0F; (&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6240;&#x4E0D;&#x540C;)&#x3002;</p><p><img alt="MAVLink v2 &#x6570;&#x636E;&#x5305;"src="../../assets/packets/packet_mavlink_v2.jpg"></p><table><thead><tr><th>&#x5B57;&#x8282;&#x7D22;&#x5F15;</th><th>C &#x7248;&#x672C;</th><th>&#x5185;&#x5BB9;</th><th>&#x503C;</th><th>&#x8BF4;&#x660E;</th></tr></thead><tbody><tr><td>0</td><td><code>uint8_t magic</code></td><td>&#x6570;&#x636E;&#x5305;&#x542F;&#x52A8;&#x6807;&#x8BB0;</td><td>0xFD</td><td>&#x7279;&#x5B9A;&#x4E8E;&#x534F;&#x8BAE;&#x7684;&#x6587;&#x672C;&#x542F;&#x52A8; (stx) &#x6807;&#x8BB0;, &#x7528;&#x4E8E;&#x6307;&#x793A;&#x65B0;&#x6570;&#x636E;&#x5305;&#x7684;&#x5F00;&#x59CB;&#x3002; &#x4EFB;&#x4F55;&#x4E0D;&#x8BC6;&#x522B;&#x534F;&#x8BAE;&#x7248;&#x672C;&#x7684;&#x7CFB;&#x7EDF;&#x90FD;&#x5C06;&#x8DF3;&#x8FC7;&#x6570;&#x636E;&#x5305;&#x3002;</td></tr><tr><td>1</td><td><code>uint8_t len</code></td><td>&#x8F7D;&#x8377;&#x957F;&#x5EA6;</td><td>0 - 255</td><td>&#x663E;&#x793A; <code>&#x6709;&#x6548;&#x8F7D;&#x8377;</code>&#x90E8;&#x5206;&#x7684;&#x957F;&#x5EA6;&#x3002; &#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x53D7;&#x5230; <a href="#payload_truncation">payload truncation </a>&#x7684;&#x5F71;&#x54CD;&#x3002;</td></tr><tr><td>2</td><td><code>uint8_t incompat_flags</code></td><td><a href="#incompat_flags">&#x4E0D;&#x517C;&#x5BB9;&#x6807;&#x5FD7;</a></td><td></td><td>&#x5FC5;&#x987B;&#x7406;&#x89E3;&#x4E3A; MAVLink &#x517C;&#x5BB9;&#x6027;&#x7684;&#x6807;&#x5FD7; (&#x5982;&#x679C;&#x4E0D;&#x7406;&#x89E3;&#x6807;&#x5FD7;, &#x5219;&#x5B9E;&#x73B0;&#x4E22;&#x5F03;&#x6570;&#x636E;&#x5305;)&#x3002;</td></tr><tr><td>3</td><td><code>uint8_t compat_flags</code></td><td><a href="#compat_flags">&#x517C;&#x5BB9;&#x6027;&#x6807;&#x5FD7;</a></td><td></td><td>&#x5982;&#x679C;&#x4E0D;&#x8BC6;&#x522B;, &#x5219;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x7684;&#x6807;&#x5FD7; (&#x5373;&#x4F7F;&#x4E0D;&#x8BC6;&#x522B;&#x6807;&#x5FD7;, &#x5B9E;&#x73B0;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x6570;&#x636E;&#x5305;)&#x3002;</td></tr><tr><td>4</td><td><code>uint8_t seq</code></td><td>&#x6570;&#x636E;&#x5305;&#x5E8F;&#x5217;&#x53F7;</td><td>0 - 255</td><td>&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x6570;&#x636E;&#x5305;&#x4E22;&#x5931;&#x3002; &#x7EC4;&#x4EF6;&#x4E3A;&#x53D1;&#x9001;&#x7684;&#x6BCF;&#x5C01;&#x6D88;&#x606F;&#x9012;&#x589E;&#x503C;&#x3002;</td></tr><tr><td>5</td><td><code>uint8_t sysid</code></td><td>&#x7CFB;&#x7EDF; ID (&#x53D1;&#x9001;&#x8005;)</td><td>1 - 255</td><td>&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7684; <em>system</em> (&#x98DE;&#x673A;) &#x7684; ID&#x3002; &#x7528;&#x4E8E;&#x533A;&#x5206;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x7CFB;&#x7EDF;&#x3002; Note that the broadcast address 0 may not be used in this field as it is an invalid <em>source</em> address.</td></tr><tr><td>6</td><td><code>uint8_t compid</code></td><td>&#x7EC4;&#x4EF6;ID (&#x53D1;&#x9001;&#x8005;)</td><td>1 - 255</td><td><em>component</em> &#x53D1;&#x9001;&#x6D88;&#x606F;ID&#x3002; Used to differentiate <em>components</em> in a <em>system</em> (e.g. autopilot and a camera). Use appropriate values in <a href="../messages/common.html#MAV_COMPONENT">MAV_COMPONENT</a>. Note that the broadcast address <code>MAV_COMP_ID_ALL</code> may not be used in this field as it is an invalid <em>source</em> address.</td></tr><tr><td><span id="v2_msgid"></span>7&#x81F3;9</td><td><code>uint32_t msgid:24</code></td><td>&#x6D88;&#x606F; ID (&#x4F4E;&#x3001;&#x4E2D;&#x7EA7;&#x3001;&#x9AD8;&#x5B57;&#x8282;)</td><td>0 - 16777215</td><td>&#x6709;&#x6548;&#x8F7D;&#x8377;&#x4E2D;&#x7684; <em>message type </em>&#x7684; id&#x3002; &#x7528;&#x4E8E;&#x5C06;&#x6570;&#x636E;&#x89E3;&#x7801;&#x56DE;&#x6D88;&#x606F;&#x5BF9;&#x8C61;&#x3002;</td></tr><tr><td><span id="v2_payload"></span>10&#x81F3; (n+10)</td><td><code>uint8_t payload[max 255]</code></td><td><a href="#payload">&#x8D1F;&#x8F7D;</a></td><td></td><td>&#x6D88;&#x606F;&#x6570;&#x636E;&#x3002; &#x53D6;&#x51B3;&#x4E8E;&#x6D88;&#x606F;&#x7C7B;&#x578B; (&#x5373;&#x6D88;&#x606F; ID) &#x548C;&#x5185;&#x5BB9;&#x3002;</td></tr><tr><td>(n+11) to (n+12)</td><td><code>uint16_t checksum</code></td><td><a href="#checksum">Checksum</a>(&#x4F4E;&#x5B57;&#x8282;, &#x9AD8;&#x5B57;&#x8282;)</td><td></td><td>X.25 CRC &#x8868;&#x793A;&#x6D88;&#x606F; (&#x4E0D;&#x5305;&#x62EC; <code>magic</code> &#x5B57;&#x8282;)&#x3002; &#x5305;&#x62EC; <a href="#crc_extra">CRC_EXTERA</a> &#x5B57;&#x8282;&#x3002;</td></tr><tr><td>(n+12) &#x81F3; (n+26)</td><td><code>uint8_t signature[13]</code></td><td><a href="message_signing.html">&#x7B7E;&#x540D;</a></td><td></td><td>(&#x53EF;&#x9009;) &#x7B7E;&#x540D;&#x4EE5;&#x786E;&#x4FDD;&#x94FE;&#x63A5;&#x4E0D;&#x53D7;&#x7BE1;&#x6539;&#x3002;</td></tr></tbody></table><ul><li>&#x6700;&#x4F4E;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;&#x662F;11&#x5B57;&#x8282;&#xFF0C;&#x7528;&#x4E8E;&#x6CA1;&#x6709;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x786E;&#x8BA4;&#x6570;&#x636E;&#x5305;&#x3002;</li><li>&#x6700;&#x5927;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;&#x4E3A; 279 &#x5B57;&#x8282;&#xFF0C;&#x7528;&#x4E8E;&#x4F7F;&#x7528;&#x6574;&#x4E2A;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x3002;</li></ul><h3 id="v1_packet_format"><a href="#v1_packet_format"class="plugin-anchor"name="v1_packet_format"><i class="fa fa-link"aria-hidden="true"></i></a>MAVLink 1 &#x7684;&#x6570;&#x636E;&#x5305;&#x683C;&#x5F0F;</h3><p>&#x4E0B;&#x9762;&#x662F; MAVLink 1 &#x6570;&#x636E;&#x5305;&#x7684;&#x7EBF;&#x5916;&#x683C;&#x5F0F; (&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6240;&#x4E0D;&#x540C;)&#x3002;</p><p><img alt="MAVLink v1 &#x6570;&#x636E;&#x5305;"src="../../assets/packets/packet_mavlink_v1.jpg"></p><table><thead><tr><th>&#x5B57;&#x8282;&#x7D22;&#x5F15;</th><th>C &#x7248;&#x672C;</th><th>&#x5185;&#x5BB9;</th><th>&#x503C;</th><th>&#x8BF4;&#x660E;</th></tr></thead><tbody><tr><td>0</td><td><code>uint8_t magic</code></td><td>&#x6570;&#x636E;&#x5305;&#x542F;&#x52A8;&#x6807;&#x8BB0;</td><td>0xFE</td><td>&#x7279;&#x5B9A;&#x4E8E;&#x534F;&#x8BAE;&#x7684;&#x6587;&#x672C;&#x542F;&#x52A8; (stx) &#x6807;&#x8BB0;, &#x7528;&#x4E8E;&#x6307;&#x793A;&#x65B0;&#x6570;&#x636E;&#x5305;&#x7684;&#x5F00;&#x59CB;&#x3002; &#x4EFB;&#x4F55;&#x4E0D;&#x8BC6;&#x522B;&#x534F;&#x8BAE;&#x7248;&#x672C;&#x7684;&#x7CFB;&#x7EDF;&#x90FD;&#x5C06;&#x8DF3;&#x8FC7;&#x6570;&#x636E;&#x5305;&#x3002;</td></tr><tr><td>1</td><td><code>uint8_t len</code></td><td>&#x8F7D;&#x8377;&#x957F;&#x5EA6;</td><td>0&#xA0;-&#xA0;255</td><td>&#x6307;&#x793A;&#x4EE5;&#x4E0B; <code>payload</code> &#x90E8;&#x5206;&#x7684;&#x957F;&#x5EA6; (&#x4E3A;&#x7279;&#x5B9A;&#x6D88;&#x606F;&#x56FA;&#x5B9A;)&#x3002;</td></tr><tr><td>2</td><td><code>uint8_t seq</code></td><td>&#x6570;&#x636E;&#x5305;&#x5E8F;&#x5217;&#x53F7;</td><td>0 - 255</td><td>&#x7528;&#x4E8E;&#x68C0;&#x6D4B;&#x6570;&#x636E;&#x5305;&#x4E22;&#x5931;&#x3002; &#x7EC4;&#x4EF6;&#x4E3A;&#x53D1;&#x9001;&#x7684;&#x6BCF;&#x5C01;&#x6D88;&#x606F;&#x9012;&#x589E;&#x503C;&#x3002;</td></tr><tr><td>3</td><td><code>uint8_t sysid</code></td><td>&#x7CFB;&#x7EDF; ID</td><td>1 - 255</td><td>&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7684; <em>system</em> (&#x98DE;&#x673A;) &#x7684; ID&#x3002; &#x7528;&#x4E8E;&#x533A;&#x5206;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x7CFB;&#x7EDF;&#x3002; Note that the broadcast address 0 may not be used in this field as it is an invalid <em>source</em> address.</td></tr><tr><td>4</td><td><code>uint8_t compid</code></td><td>&#x7EC4;&#x4EF6;ID</td><td>1 - 255</td><td><em>component</em> &#x53D1;&#x9001;&#x6D88;&#x606F;ID&#x3002; &#x7528;&#x4E8E;&#x533A;&#x5206; <em>system</em> &#x4E2D;&#x7684;&#x7EC4;&#x4EF6; (&#x4F8B;&#x5982;&#x81EA;&#x52A8;&#x9A7E;&#x9A76;&#x4EEA;&#x548C;&#x76F8;&#x673A;)&#x3002; Use appropriate values in <a href="../messages/common.html#MAV_COMPONENT">MAV_COMPONENT</a>. Note that the broadcast address <code>MAV_COMP_ID_ALL</code> may not be used in this field as it is an invalid <em>source</em> address.</td></tr><tr><td><span id="v1_msgid"></span>5</td><td><code>uint8_t msgid</code></td><td>&#x6D88;&#x606F; ID</td><td>0 - 255</td><td>&#x6709;&#x6548;&#x8F7D;&#x8377;&#x4E2D;&#x7684; <em>message type </em>&#x7684; id&#x3002; &#x7528;&#x4E8E;&#x5C06;&#x6570;&#x636E;&#x89E3;&#x7801;&#x56DE;&#x6D88;&#x606F;&#x5BF9;&#x8C61;&#x3002;</td></tr><tr><td><span id="v1_payload"></span>6&#x81F3; (n+6)</td><td><code>uint8_t payload[max 255]</code></td><td>&#x6709;&#x6548;&#x8D1F;&#x8F7D;&#x6570;&#x636E;</td><td></td><td>&#x6D88;&#x606F;&#x6570;&#x636E;&#x3002; &#x5185;&#x5BB9;&#x53D6;&#x51B3;&#x4E8E;&#x6D88;&#x606F;&#x7C7B;&#x578B;(&#x5373;&#x6D88;&#x606F;ID)&#x3002;</td></tr><tr><td>(n+7) &#x81F3; (n+8)</td><td><code>uint16_t checksum</code></td><td><a href="#checksum">Checksum</a>(&#x4F4E;&#x5B57;&#x8282;, &#x9AD8;&#x5B57;&#x8282;)</td><td></td><td>X.25 CRC &#x8868;&#x793A;&#x6D88;&#x606F; (&#x4E0D;&#x5305;&#x62EC; <code>magic</code> &#x5B57;&#x8282;)&#x3002; &#x5305;&#x62EC; <a href="#crc_extra">CRC_EXTERA</a> &#x5B57;&#x8282;&#x3002;</td></tr></tbody></table><ul><li>&#x6700;&#x4F4E;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;&#x662F;8&#x5B57;&#x8282;&#xFF0C;&#x7528;&#x4E8E;&#x6CA1;&#x6709;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x786E;&#x8BA4;&#x6570;&#x636E;&#x5305;&#x3002;</li><li>&#x6700;&#x5927;&#x7684;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;&#x662F;&#x5B8C;&#x6574;&#x6709;&#x6548;&#x8F7D;&#x8377;263&#x5B57;&#x8282;&#x3002;</li></ul><h2 id="incompat_flags"><a href="#incompat_flags"class="plugin-anchor"name="incompat_flags"><i class="fa fa-link"aria-hidden="true"></i></a>&#x4E0D;&#x517C;&#x5BB9;&#x6807;&#x8BB0; (MAVLink 2)</h2><p>&#x4F7F;&#x7528;&#x4E0D;&#x517C;&#x5BB9;&#x7684;&#x65D7;&#x5E1C;&#x6765;&#x663E;&#x793A;&#x4E00;&#x4E2A; MAVLink &#x5E93;&#x5FC5;&#x987B;&#x652F;&#x6301;&#x624D;&#x80FD;&#x5904;&#x7406;&#x6570;&#x636E;&#x5305;&#x3002; &#x8FD9;&#x5305;&#x62EC;&#x5F71;&#x54CD;&#x6570;&#x636E;&#x5305;&#x683C;&#x5F0F;/&#x8BA2;&#x5236;&#x7684;&#x4EFB;&#x4F55;&#x529F;&#x80FD;&#x3002;</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>&#x5982;&#x679C; <code>incompat_flags</code> &#x5B57;&#x6BB5;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x6807;&#x5FD7;&#x4E0D;&#x8BC6;&#x522B;, &#x5219; MAVLink <strong>&#x5FC5;&#x987B;&#x4E22;&#x5F03;</strong>&#x3002;</p></blockquote><p>&#x652F;&#x6301;&#x7684;&#x4E0D;&#x517C;&#x5BB9;&#x6807;&#x5FD7;&#x5305;&#x62EC; (&#x5728;&#x7F16;&#x5199;&#x672C;&#x6587;&#x65F6;):</p><table><thead><tr><th>&#x6807;&#x8BB0;</th><th>C &#x6807;&#x5FD7;</th><th>&#x7279;&#x6027;</th></tr></thead><tbody><tr><td><span id="MAVLINK_IFLAG_SIGNED"></span>0x01</td><td><code>MAVLINK_IFLAG_SIGNED</code></td><td>&#x6570;&#x636E;&#x5305; <a href="message_signing.html">signed</a> (&#x7B7E;&#x540D;&#x5DF2;&#x8FFD;&#x52A0;&#x5230;&#x6570;&#x636E;&#x5305;&#x4E2D;)&#x3002;</td></tr></tbody></table><h2 id="compat_flags"><a href="#compat_flags"class="plugin-anchor"name="compat_flags"><i class="fa fa-link"aria-hidden="true"></i></a>&#x517C;&#x5BB9;&#x6027;&#x6807;&#x8BB0; (MAVLink 2)</h2><p>&#x517C;&#x5BB9;&#x6027;&#x6807;&#x8BB0;&#x7528;&#x4E8E;&#x663E;&#x793A;&#x529F;&#x80FD;&#xFF0C;&#x65E0;&#x6CD5;&#x963B;&#x6B62; MAVLink &#x5E93;&#x5904;&#x7406;&#x6570;&#x636E;&#x5305; (&#x5373;&#x4F7F;&#x4E0D;&#x80FD;&#x8BC6;&#x522B;&#x6B64;&#x529F;&#x80FD;)&#x3002; &#x4F8B;&#x5982;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x5305;&#x62EC;&#x4E00;&#x4E2A;&#x6807;&#x5FD7;&#xFF0C;&#x4EE5;&#x8868;&#x660E;&#x6570;&#x636E;&#x5305;&#x5E94;&#x88AB;&#x89C6;&#x4E3A;&#x201C;&#x9AD8;&#x5EA6;&#x4F18;&#x5148;&#x7EA7;&#x201D;&#xFF0C; (&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5305;&#x683C;&#x5F0F;&#x548C;&#x7ED3;&#x6784;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#xFF0C;&#x8FD9;&#x79CD;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EFB;&#x4F55; MAVLink &#x6267;&#x884C;&#x5904;&#x7406;)&#x3002;</p><p>&#x4E00;&#x4E2A; MAVLink &#x6267;&#x884C;&#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x5730;&#x5FFD;&#x7565;&#x5B83;&#x5728; <code>compat_latime</code> &#x5B57;&#x6BB5;&#x4E2D;&#x4E0D;&#x8BC6;&#x522B;&#x7684;&#x65D7;&#x5E1C;&#x3002;</p><h2 id="payload"><a href="#payload"class="plugin-anchor"name="payload"><i class="fa fa-link"aria-hidden="true"></i></a>&#x6709;&#x6548;&#x8D1F;&#x8F7D;&#x683C;&#x5F0F;</h2><p>MAVLink &#x6CA1;&#x6709;&#x5305;&#x542B;&#x5173;&#x4E8E;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x672C;&#x8EAB;&#x7684;&#x4FE1;&#x606F;&#x7ED3;&#x6784;&#x7684;&#x4FE1;&#x606F; (&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x95F4;&#x63A5;&#x5F00;&#x9500;)! &#x76F8;&#x53CD;, &#x53D1;&#x9001;&#x65B9;&#x548C;&#x63A5;&#x6536;&#x65B9;&#x5FC5;&#x987B;&#x5BF9;&#x65E0;&#x7EBF;&#x683C;&#x5F0F;&#x7684;&#x6D88;&#x606F;&#x5B57;&#x6BB5;&#x7684;&#x542B;&#x4E49;&#x3001;&#x987A;&#x5E8F;&#x548C;&#x5927;&#x5C0F;&#x6709;&#x5171;&#x540C;&#x7684;&#x6807;&#x8BC6;&#x3002;</p><p>&#x6D88;&#x606F;&#x5728; MAVLink &#x6570;&#x636E;&#x5305;&#x4E2D;&#x8FDB;&#x884C;&#x7F16;&#x7801;:</p><ul><li><code>msgid</code>(&#x6D88;&#x606F;id) &#x5B57;&#x6BB5;&#x786E;&#x5B9A;&#x4E86;&#x5728;&#x6570;&#x636E;&#x5305;&#x4E2D;&#x7F16;&#x7801;&#x7684;&#x5177;&#x4F53;&#x6D88;&#x606F;&#x3002;</li><li><code>payload</code> &#x5B57;&#x6BB5;&#x5305;&#x542B;&#x6D88;&#x606F;&#x6570;&#x636E;&#x3002;<ul><li>MAVLink <a href="#field_reordering">reorders the message fields</a> &#x8D85;&#x7535;&#x7EBF;&#x4F20;&#x8F93;&#x7684;&#x6709;&#x6548;&#x8F7D;&#x8377; (&#x4ECE;&#x539F;&#x59CB; <a href="../messages/">XML Message Definitions</a>)&#x3002;</li><li>&#x5728;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x4E4B;&#x524D;, MAVLink 2 <a href="mavlink_2.html#packet_truncation">truncates</a> &#x6709;&#x6548;&#x8D1F;&#x8F7D;&#x672B;&#x5C3E;&#x7684;&#x4EFB;&#x4F55;&#x96F6;&#x586B;&#x5145;&#x5B57;&#x8282;, &#x5E76;&#x9002;&#x5F53;&#x5730;&#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x5305; <code>len</code> &#x5B57;&#x6BB5; (MAVLink 1 &#x59CB;&#x7EC8;&#x53D1;&#x9001;&#x6240;&#x6709;&#x5B57;&#x8282;)&#x3002;</li></ul></li><li><code>len</code> &#x5B57;&#x6BB5;&#x5305;&#x542B;&#x6709;&#x6548;&#x8D1F;&#x8F7D;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#x3002;</li><li><p><a href="#crc_extra">CRC_EXTRA</a> &#x5B57;&#x8282;&#x6DFB;&#x52A0;&#x5230;&#x6D88;&#x606F; <a href="#checksum">checksum</a>&#x3002; &#x63A5;&#x6536;&#x5668;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x786E;&#x8BA4;&#x5B83;&#x4E0E;&#x6709;&#x6548;&#x8D1F;&#x8F7D;&#x6D88;&#x606F;&#x683C;&#x5F0F;/&#x5B9A;&#x4E49;&#x517C;&#x5BB9;&#x3002;</p><blockquote class="alert clearfix alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong><p>&#x5982;&#x679C;&#x6D88;&#x606F;&#x89C4;&#x8303;&#x4E0D;&#x517C;&#x5BB9; (&#x4F8B;&#x5982; c &#x5E93; <a href="../getting_started/use_libraries.html#receiving">mavlink_parse_char()</a> &#x7ED9;&#x51FA;&#x72B6;&#x6001; <code>MAVLINK_FRAMING_BAD_CRC</code>), &#x5219; MAVLink &#x5E93;&#x5E94;&#x5728;&#x89E3;&#x7801;&#x8FC7;&#x7A0B;&#x4E2D;&#x901A;&#x77E5;&#x9519;&#x8BEF;&#x7684; crc&#x3002;</p></blockquote></li></ul><h3 id="field_reordering"><a href="#field_reordering"class="plugin-anchor"name="field_reordering"><i class="fa fa-link"aria-hidden="true"></i></a>&#x5B57;&#x6BB5;&#x91CD;&#x65B0;&#x6392;&#x5E8F;</h3><p>&#x6D88;&#x606F;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x5B57;&#x6BB5;&#x91CD;&#x65B0;&#x6392;&#x5E8F;&#xFF0C;&#x4EE5;&#x4FBF;&#x4F20;&#x8F93;&#x5982;&#x4E0B;&#xFF1A;</p><ul><li>Fields are sorted according to their native data size:<ul><li><code>(u)int64_t</code>, <code>double</code> (8 bytes)</li><li><code>(u)int32_t</code>, <code>float</code> (4)</li><li><code>(u)int16_t</code> (2)</li><li><code>(u)int8_t</code>, <code>char</code> (1)</li></ul></li><li>&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x5B57;&#x6BB5;&#x7684;&#x957F;&#x5EA6;&#x76F8;&#x540C;, &#x5219;&#x5B83;&#x4EEC;&#x7684;&#x987A;&#x5E8F;&#x5C06;&#x4FDD;&#x7559;&#x4E3A;&#x6570;&#x636E;&#x5B57;&#x6BB5;&#x5927;&#x5C0F;&#x6392;&#x5E8F;&#x4E4B;&#x524D;&#x7684;&#x987A;&#x5E8F;</li><li>&#x6839;&#x636E;&#x5B83;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x5904;&#x7406;&#x6570;&#x7EC4;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6839;&#x636E;&#x603B;&#x6570;&#x7EC4;&#x5927;&#x5C0F;&#x5904;&#x7406;</li><li>&#x5DF2;&#x4F20;&#x8F93;&#x7684;&#x62A5;&#x6587;&#x4E0E; <code>construction</code> &#x76F8;&#x540C;&#xFF0C;&#x56E0;&#x6B64;&#x4EE3;&#x8868;&#x91CD;&#x65B0;&#x6392;&#x5E8F;&#x7684;&#x5B57;&#x6BB5;</li><li><code>CRC_EXTERA</code> &#x5B57;&#x6BB5;&#x5728;&#x91CD;&#x65B0;&#x6392;&#x5E8F; <em>&#x540E;</em> &#x8BA1;&#x7B97;&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x5B57;&#x6BB5;&#x4E2D;&#x7684;&#x9519;&#x8BEF;&#x53EF;&#x4EE5;&#x88AB;&#x9ED8;&#x8BA4; CRC &#x53D1;&#x73B0;&#x3002; &#x63D0;&#x4F9B;&#x7684; Python, C &#x548C; C# &#x53C2;&#x8003;&#x6267;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x4EE5;&#x4FBF;&#x6B63;&#x786E;&#x5730;&#x91CD;&#x65B0;&#x6392;&#x5E8F;&#xFF0C;&#x8FD9;&#x53EA;&#x662F;&#x4E60;&#x60EF;&#x6267;&#x884C;&#x7684;&#x5173;&#x5207;&#x3002;</li></ul><p>&#x4E0A;&#x8FF0;&#x91CD;&#x65B0;&#x6392;&#x5E8F;&#x7684;&#x552F;&#x4E00;&#x4F8B;&#x5916;&#x662F; <a href="define_xml_element.html#message_extensions">MAVLink 2 &#x6269;&#x5C55;&#x5B57;&#x6BB5;</a>&#x3002; &#x6269;&#x5C55;&#x5B57;&#x6BB5;&#x4EE5; XML-Declaration &#x7684;&#x987A;&#x5E8F;&#x53D1;&#x9001;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;&#x5728;<a href="#crc_extra">CRC_EXTERA</a> &#x8BA1;&#x7B97;&#x4E2D;&#x3002; &#x8FD9;&#x5141;&#x8BB8;&#x65B0;&#x7684;&#x6269;&#x5C55;&#x5B57;&#x6BB5;&#x5728;&#x6D88;&#x606F;&#x7ED3;&#x675F;&#x540E;&#x9644;&#x52A0;&#xFF0C;&#x4F46;&#x4E0D;&#x6253;&#x7834;&#x4E8C;&#x8FDB;&#x5236;&#x517C;&#x5BB9;&#x6027;&#x3002;</p><blockquote class="alert clearfix alert-warning"><strong class="fa fa-2x fa-exclamation-triangle"></strong><p>&#x6B64;&#x8BA2;&#x5355;&#x662F;&#x72EC;&#x7279;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x7A33;&#x5B9A;&#x7684;&#x5206;&#x7C7B;&#x7B97;&#x6CD5;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5728;&#x534F;&#x8BAE;&#x4E2D;&#x8F7B;&#x677E;&#x5B9E;&#x73B0;&#x3002; &#x66FF;&#x4EE3;&#x7D22;&#x5F15;&#x8981;&#x4E48;&#x6548;&#x7387;&#x4F4E;&#x4E0B;&#xFF0C;&#x4E0D;&#x5229;&#x4E8E; MAVLink &#x5E94;&#x7528;&#x7684;&#x5178;&#x578B;&#x76EE;&#x6807;&#x67B6;&#x6784;&#xFF0C;&#x6216;&#x8005;&#x8981;&#x652F;&#x6301;&#x6309;&#x53D8;&#x91CF;&#x5927;&#x5C0F;&#x4E3A;&#x987A;&#x5E8F;&#x7684;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5E94;&#x7528;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002; &#x8FD9;&#x5C06;&#x5BFC;&#x81F4;&#x5E8F;&#x5217;&#x5316;&#x51FD;&#x6570;&#x7684;&#x529F;&#x80FD;&#x7B7E;&#x540D;&#x975E;&#x5E38;&#x6DF7;&#x4E71;&#x3002;</p></blockquote><h3 id="payload_truncation"><a href="#payload_truncation"class="plugin-anchor"name="payload_truncation"><i class="fa fa-link"aria-hidden="true"></i></a>&#x7A7A;&#x5B57;&#x8282;&#x6709;&#x6548;&#x8D1F;&#x8F7D;&#x622A;&#x65AD; (MAVLink 2)</h3><p><em>MAVLink 2</em> &#x5728;&#x5E8F;&#x5217;&#x5316;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x53D1;&#x9001;&#x4E4B;&#x524D;&#x622A;&#x65AD;&#x4EFB;&#x4F55;&#x7A7A;&#x7684;(&#x96F6;&#x586B;&#x5145;) &#x5B57;&#x8282;&#x3002; &#x8FD9;&#x4E0E; <em>MAVLink 1</em>&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6240;&#x6709;&#x5B57;&#x6BB5;&#x90FD;&#x53D1;&#x9001;&#x4E86;&#x5B57;&#x8282;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x662F;&#x8FD9;&#x6837;&#x3002;</p><p>&#x4FDD;&#x5B58;&#x7684;&#x5B9E;&#x9645;&#x5B57;&#x6BB5;/&#x5B57;&#x8282;&#x53D6;&#x51B3;&#x4E8E;&#x6D88;&#x606F;&#x53CA;&#x5176;&#x5185;&#x5BB9; (MAVLink <a href="serialization.html#field_reordering">field reordering</a> &#x610F;&#x5473;&#x7740;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BF4;&#xFF0C;&#x4EFB;&#x4F55;&#x622A;&#x65AD;&#x5B57;&#x6BB5;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x6700;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x5927;&#x5C0F;&#x6216;&#x6269;&#x5C55;&#x5B57;&#x6BB5;)&#x3002;</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>The first byte of the payload is never truncated, even if the payload consists entirely of zeros.</p></blockquote><p><span></span></p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>The protocol only truncates empty bytes at the end of the serialized message payload; any null bytes/empty fields within the body of the payload are not affected.</p></blockquote><h3 id="crc_extra"><a href="#crc_extra"class="plugin-anchor"name="crc_extra"><i class="fa fa-link"aria-hidden="true"></i></a>CRC_EXTERA &#x8BA1;&#x7B97;</h3><p>The <code>CRC_EXTRA</code> CRC is used to verify that the sender and receiver have a shared understanding of the over-the-wire format of a particular message.</p><blockquote class="alert clearfix alert-success"><strong class="fa fa-2x fa-thumbs-o-up"></strong><p>Changes in <a href="../messages/">message specifications</a> that might make the over-the-wire format incompatible include: new/removed fields, or changes to field name, data type, order, or array length.</p></blockquote><p>When the MAVLink code generator runs, it takes a checksum of the XML structure for each message and creates an array define <code>MAVLINK_MESSAGE_CRCS</code>. This is used to initialise the <code>mavlink_message_crcs[]</code> array in the C/C++ implementation, and is similarly used in the Python (or any other, such as the C# and JavaScript) implementation.</p><p>When the sender calculates the checksum for a message it adds the <code>CRC_EXTRA</code> byte onto the end of the data that the checksum is calculated over. The recipient calculates a checksum for the received message and adds its own <code>CRC_EXTRA</code> for the particular message id. If the <code>CRC_EXTRA</code> for the sender and receiver are different the checksums will not match.</p><p>This approach ensures that only messages where the sender and recipient are using the same message structure will be decoded (or at least it makes a mistake much more unlikely, as for any checksum application).</p><p>If you are doing your own implementation of MAVLink you can get this checksum in one of two ways: you can include the generated headers and use <code>MAVLINK_MESSAGE_CRCS</code> to get the right seed for each message type, or you can re-implement the code that calculates the seed.</p><p>As MAVLink internally reorders the message fields according to their size to prevent word / halfword alignment issues (see <a href="http://en.wikipedia.org/wiki/Data%20structure%20alignment"target="_blank">Data structure alignment</a> (Wikipedia) for further reference), and a wrongly implemented reordering potentially can cause inconsistencies as well, the <code>CRC_EXTRA</code> is calculated based on the over-the-air message layout rather than the XML order.</p><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p><a href="define_xml_element.html#message_extensions">MAVLink 2 extension fields</a> are not included in the <code>CRC_EXTRA</code> calculation.</p></blockquote><p>This is the Python code that calculates the <code>CRC_EXTRA</code> seed:</p><pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message_checksum</span><span class="hljs-params">(msg)</span>:</span>
    <span class="hljs-string">&apos;&apos;&apos;calculate a 8-bit checksum of the key fields of a message, so we
       can detect incompatible XML changes&apos;&apos;&apos;</span>
    <span class="hljs-keyword">from</span> .mavcrc <span class="hljs-keyword">import</span> x25crc
    crc = x25crc()
    crc.accumulate_str(msg.name + <span class="hljs-string">&apos; &apos;</span>)
    <span class="hljs-comment"># in order to allow for extensions the crc does not include</span>
    <span class="hljs-comment"># any field extensions</span>
    crc_end = msg.base_fields()
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(crc_end):
        f = msg.ordered_fields[i]
        crc.accumulate_str(f.type + <span class="hljs-string">&apos; &apos;</span>)
        crc.accumulate_str(f.name + <span class="hljs-string">&apos; &apos;</span>)
        <span class="hljs-keyword">if</span> f.array_length:
            crc.accumulate([f.array_length])
    <span class="hljs-keyword">return</span> (crc.crc&amp;<span class="hljs-number">0xFF</span>) ^ (crc.crc&gt;&gt;<span class="hljs-number">8</span>)
</code></pre><blockquote class="alert clearfix alert-info"><strong class="fa fa-2x fa-edit"></strong><p>This uses the same x25 checksum that is used at runtime. It calculates a CRC over the message name (such as &#x201C;RAW_IMU&#x201D;) followed by the type and name of each field, space separated. The order of the fields is the order they are sent over the wire. For arrays, the array length is also added.</p></blockquote><h2 id="checksum"><a href="#checksum"class="plugin-anchor"name="checksum"><i class="fa fa-link"aria-hidden="true"></i></a>&#x6821;&#x9A8C;&#x548C;</h2><p>The packet format includes a 2-byte CRC to allow detection of message corruption. The checksum is the same as used in ITU X.25 and SAE AS-4 standards (<a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check#Polynomial_representations_of_cyclic_redundancy_checks"target="_blank">CRC-16-CCITT</a>), documented in <a href="http://www.sae.org/servlets/productDetail?PROD_TYP=STD&amp;PROD_CD=AS5669A"target="_blank">SAE AS5669A</a>. See the MAVLink source code for <a href="https://github.com/mavlink/c_library_v2/blob/master/checksum.h"target="_blank">the documented C-implementation</a>.</p><p>The CRC covers the whole message, excluding <code>magic</code> byte and the signature (if present). The CRC includes the <a href="#crc_extra">CRC_EXTRA</a> byte, which is used to ensure that the sending and receiving systems share a common understanding of the message definition.</p></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1><ul class="search-results-list"></ul></div><div class="no-results"><h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1></div></div></div></div></div></div></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{title:"Serialization",level:"1.3.4",depth:2,next:{title:"Routing",level:"1.3.5",depth:2,path:"guide/routing.md",ref:"guide/routing.md",articles:[]},previous:{title:"Message Signing",level:"1.3.3",depth:2,path:"guide/message_signing.md",ref:"guide/message_signing.md",articles:[]},dir:"ltr"},config:{plugins:["theme-api","youtube","richquotes@git+https://github.com/Dronecode/gitbook-plugin-richquotes.git","anchors","collapsible-menu","page-toc-button","toolbar@git+https://github.com/hamishwillee/gitbook-plugin-toolbar.git","language-picker","custom-favicon","bulk-redirect@git+https://github.com/Dronecode/gitbook-plugin-bulk-redirect.git","-mermaid","-stub-out-blocks@git+https://github.com/hamishwillee/gitbook-plugin-stub-out-blocks.git","validate-links","theme-dronecode@git+https://github.com/dronecode/theme-dronecode.git","html-minifier"],styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},pluginsConfig:{"theme-dronecode":{logo:{logo_large:"../assets/site/logo_mavlink_header.png",logo_small:"../assets/site/logo_mavlink_header.png",url:"https://mavlink.io/en/"},menu:[{url:"https://mavlink.io/en/messages/common.html",text:"Messages",text_small:"Messages"},{url:"https://mavlink.io/en/about/faq.html",text:"FAQ",text_small:"FAQ"},{url:"https://mavlink.io/en/about/implementations.html",text:"Implementations",text_small:"Implementations"},{url:"https://mavlink.io/en/examples/",text:"Examples",text_small:"Examples"},{url:"https://mavlink.io/en/about/support.html",text:"Support",text_small:"Help"}]},"validate-links":{defaultScheme:"https",local:"warn",remote:"disabled"},"collapsible-menu":{},"language-picker":{"grid-columns":3},youtube:{},search:{},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!1,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},fontsettings:{theme:"white",family:"sans",size:2},richquotes:{tip:{alert:"success",picto:"fa-thumbs-o-up"}},highlight:{},favicon:"favicon.ico","page-toc-button":{},"theme-api":{languages:[{lang:"c",name:"C/C++",default:!0},{lang:"python",name:"Python"},{lang:"js",name:"JavaScript"},{lang:"go",name:"Go"}],split:!0,theme:"light"},"bulk-redirect":{basepath:"/",redirectsFile:"redirects.json"},"custom-favicon":{},toolbar:{buttons:[{label:"Bug tracker",icon:"fa fa-bug",position:"left",url:"https://github.com/mavlink/mavlink-devguide/issues/new?title=Doc+Bug:+{{title}}&body=DESCRIBE+PROBLEM+WITH+DOCS+HERE%0A%0ABug+Page:+[{{title}}]({{url}})"},{label:"GitHub",icon:"fa fa-github",url:"https://github.com/mavlink/mavlink-devguide"},{label:"Edit page on github",icon:"fa fa-pencil-square-o",position:"left",url:"https://github.com/mavlink/mavlink-devguide/edit/master/{{filepath_lang}}"}]},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1},anchors:{}},theme:"default",pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{logo:"./assets/site/logo_mavlink_small.png"},title:"MAVLink Developer Guide",language:"zh",gitbook:"*"},file:{path:"guide/serialization.md",mtime:"2020-06-23T04:15:45.158Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2020-06-23T04:17:13.916Z"},basePath:"..",book:{language:"zh"}})})</script></div><script src="../../gitbook/gitbook.js"></script><script src="../../gitbook/theme.js"></script><script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script><script src="../../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script><script src="../../gitbook/gitbook-plugin-toolbar/buttons.js"></script><script src="../../gitbook/gitbook-plugin-language-picker/plugin.js"></script><script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script><script src="../../gitbook/gitbook-plugin-search/search.js"></script><script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script><script src="../../gitbook/gitbook-plugin-theme-api/theme-api.js"></script></body></html>